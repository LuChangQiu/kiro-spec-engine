# 需求文档：交互式业务定制平台（Moqui 实验）

## 简介

本 Spec 定义一个“面向业务专家、非技术用户可用”的交互式改进平台能力。

平台以已定制的 Moqui 产品为实验对象，通过 SCE 驱动的对话式 Agent，让用户在业务上下文中提出优化诉求，并在严格安全边界内完成“建议 -> 计划 -> 执行 -> 回滚 -> 审计”的闭环。

目标不是让 AI 无约束改代码，而是建立 **受限可编程（Constrained Programmability）** 与 **默认门禁（Secure By Default）** 的可持续改进模型，并沉淀为跨行业可复用方法。

## 术语表

- **Business_Copilot**: 嵌入在产品 UI 的对话式 AI 助手，理解页面上下文和业务目标。
- **Change_Intent**: 用户以业务语言表达的改进意图（如规则调整、流程优化、字段扩展）。
- **Change_Plan**: 结构化变更计划（对象、范围、影响、风险、验证、回滚），执行前必须可审阅。
- **Guardrail_Pipeline**: 变更执行前后的安全与质量门禁流水线（策略校验、风险评分、审批、测试、审计）。
- **Adapter**: 面向不同技术栈的执行适配层，将统一语义变更映射为具体代码/配置/模板变更。
- **Domain_Pack**: 行业能力包（模板、ontology、规则、场景、策略），用于快速落地垂直领域。
- **Moqui_Experiment_Product**: 本阶段实验产品，基于 Moqui 深度定制版本。

## 需求

### 需求 1：页面上下文对话改进入口

**用户故事：** 作为业务用户，我希望在当前页面直接描述我的业务诉求，而不是学习代码或命令。

#### 验收标准

1. THE Business_Copilot SHALL 在页面级提供可调用入口，并读取当前页面上下文（模块、实体、关键字段、当前流程节点）。
2. WHEN 用户提交业务诉求 THEN 系统 SHALL 生成结构化 Change_Intent（包含目标、约束、优先级、影响对象）。
3. THE 对话输出 SHALL 使用业务可读语言，并可追溯到对应的业务对象与场景标识。

### 需求 2：默认建议模式（禁止直接高风险落盘）

**用户故事：** 作为平台运营者，我希望系统默认先给方案，不直接写入高风险变更。

#### 验收标准

1. THE 平台 SHALL 默认以“建议模式”运行：先输出 Change_Plan，不直接执行高风险变更。
2. THE Change_Plan SHALL 包含：
   - 变更范围（对象/模块/接口/模板）
   - 影响分析（业务影响、技术影响、数据影响）
   - 风险等级（low/medium/high）
   - 验证步骤与验收检查项
   - 回滚方案
3. WHEN 变更风险等级为 high THEN 系统 SHALL 强制进入审批状态，不允许直接执行。

### 需求 3：代码与数据安全默认门禁

**用户故事：** 作为安全负责人，我希望平台在没有额外配置时也具备安全基线能力。

#### 验收标准

1. THE Guardrail_Pipeline SHALL 默认启用以下门禁：
   - 权限校验（最小权限）
   - 敏感数据保护（脱敏/最小暴露）
   - 密钥与凭证隔离（禁止在对话/日志明文泄露）
   - 高风险操作阻断（如批量删除、权限提升、不可逆写入）
2. THE 平台 SHALL 记录每次变更的审计链路（提出者、审批者、执行者、时间、差异、结果）。
3. WHEN 数据访问超出授权范围 THEN 系统 SHALL 阻断并输出可解释原因。

### 需求 4：审批、执行、回滚闭环

**用户故事：** 作为产品管理员，我希望每次改动都可控、可验证、可回退。

#### 验收标准

1. THE 平台 SHALL 提供变更审批流（至少包含提交、审批、执行、复核四状态）。
2. WHEN 变更执行完成 THEN 系统 SHALL 输出机器可读与人工可读的执行报告（diff、结果、验证、风险结论）。
3. THE 平台 SHALL 支持一键回滚到最近稳定版本，并保留回滚审计记录。

### 需求 5：Moqui 实验产品落地能力

**用户故事：** 作为产品负责人，我希望先在 Moqui 场景形成可运行闭环，再复制到其他行业。

#### 验收标准

1. THE 平台 SHALL 以 Moqui_Experiment_Product 作为首个标准实验对象。
2. THE 平台 SHALL 支持在 Moqui 场景下完成以下类型改进：
   - 业务规则参数调整
   - 表单/页面字段与布局调整
   - 流程节点与审批策略调整
3. THE 实验过程 SHALL 产出可复用模板资产（scene-package / ontology / governance contract / playbook）。

### 需求 6：跨技术栈扩展接口

**用户故事：** 作为平台架构师，我希望在不同语言框架下复用同一套业务改进机制。

#### 验收标准

1. THE 平台 SHALL 定义统一 Adapter 接口契约，将 Change_Plan 映射为目标技术栈的执行动作。
2. THE Adapter 契约 SHALL 覆盖：
   - 能力声明（支持的改进类型）
   - 风险声明（可执行等级与限制）
   - 验证与回滚接口
3. WHEN 新行业接入 THEN 系统 SHALL 支持通过 Domain_Pack 扩展，而不改动核心安全门禁流程。

### 需求 7：持续改进观测与治理

**用户故事：** 作为平台治理者，我希望持续知道“改进是否有效、是否安全、是否可规模化复制”。

#### 验收标准

1. THE 平台 SHALL 记录关键指标：
   - 变更建议采纳率
   - 执行成功率
   - 回滚率
   - 安全拦截率
   - 用户满意度反馈
2. THE 平台 SHALL 支持按周期输出治理报告，用于发布决策与策略调优。
3. WHEN 指标触发风险阈值 THEN 系统 SHALL 输出治理告警与修复建议。
