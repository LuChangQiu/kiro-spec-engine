# Requirements Document

## Introduction

This specification addresses the issue where users cannot manually edit repository configurations in `.kiro/project-repos.json`. Currently, only KSE auto-generated configurations pass validation, preventing users from manually curating their repository list, removing false positives, or adding repositories that weren't auto-detected.

## Glossary

- **Config_Manager**: The component responsible for validating and managing repository configurations
- **Manual_Config**: A repository configuration file created or edited by the user directly
- **Auto_Config**: A repository configuration file generated by KSE's auto-scan functionality
- **Validation_Engine**: The logic that validates repository configuration files
- **Repository_Entry**: A single repository record in the configuration file containing name, path, and optional metadata

## Requirements

### Requirement 1: Manual Configuration Support

**User Story:** As a developer, I want to manually edit `.kiro/project-repos.json`, so that I can curate my repository list without relying solely on auto-detection.

#### Acceptance Criteria

1. WHEN a user manually creates a configuration file with valid repository entries, THEN the Validation_Engine SHALL accept the configuration
2. WHEN a user manually edits an auto-generated configuration to remove entries, THEN the Validation_Engine SHALL accept the modified configuration
3. WHEN a user manually adds a new repository entry to an existing configuration, THEN the Validation_Engine SHALL accept the updated configuration
4. THE Validation_Engine SHALL treat manual and auto-generated configurations identically during validation

### Requirement 2: Flexible Field Requirements

**User Story:** As a developer, I want to specify minimal repository information, so that I can quickly add local-only repositories without unnecessary metadata.

#### Acceptance Criteria

1. WHEN a repository entry contains name and path fields, THEN the Validation_Engine SHALL accept the entry as valid
2. WHERE a repository has no remote URL, THE Validation_Engine SHALL accept entries without the remote field
3. WHERE a repository has no branch information, THE Validation_Engine SHALL accept entries without the branch field
4. THE Validation_Engine SHALL require only name and path as mandatory fields for each repository entry

### Requirement 3: Path Validation

**User Story:** As a developer, I want clear feedback when I specify invalid repository paths, so that I can quickly correct configuration errors.

#### Acceptance Criteria

1. WHEN a repository entry specifies a path that does not exist, THEN the Validation_Engine SHALL reject the entry with a descriptive error message
2. WHEN a repository entry specifies a path without a .git directory, THEN the Validation_Engine SHALL reject the entry with a descriptive error message
3. WHEN a repository entry specifies a path to a Git worktree (.git file instead of directory), THEN the Validation_Engine SHALL reject the entry with a descriptive error message
4. WHEN validation fails, THEN the error message SHALL include the repository name and the specific validation failure reason

### Requirement 4: Clear Error Messages

**User Story:** As a developer, I want clear validation error messages, so that I can understand and fix configuration issues quickly.

#### Acceptance Criteria

1. WHEN validation fails, THEN the Validation_Engine SHALL provide an error message identifying the problematic repository entry
2. WHEN validation fails, THEN the error message SHALL explain what validation rule was violated
3. WHEN validation fails, THEN the error message SHALL suggest how to fix the issue
4. WHEN multiple entries fail validation, THEN the Validation_Engine SHALL report all failures, not just the first one

### Requirement 5: Backward Compatibility

**User Story:** As a developer with existing auto-generated configurations, I want the new validation to work with my existing setup, so that I don't need to regenerate my configuration.

#### Acceptance Criteria

1. WHEN validating an auto-generated configuration from previous versions, THEN the Validation_Engine SHALL accept all valid entries
2. WHEN validating configurations with optional fields present, THEN the Validation_Engine SHALL accept and preserve those fields
3. THE Validation_Engine SHALL maintain compatibility with all configuration formats from v1.18.0 onwards
4. WHEN upgrading from a previous version, THEN existing valid configurations SHALL continue to work without modification

### Requirement 6: Configuration File Format

**User Story:** As a developer, I want to understand the expected configuration file format, so that I can manually create valid configurations.

#### Acceptance Criteria

1. THE Config_Manager SHALL accept JSON files with a repositories array at the root level
2. WHEN a configuration file is malformed JSON, THEN the Validation_Engine SHALL reject it with a JSON parsing error message
3. WHEN a configuration file is missing the repositories array, THEN the Validation_Engine SHALL reject it with a descriptive error message
4. THE Config_Manager SHALL document the expected configuration file schema in error messages and documentation
