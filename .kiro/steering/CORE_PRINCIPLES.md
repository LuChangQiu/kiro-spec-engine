# 核心开发原则（基准规则）

> **重要**: 这些是项目的基准规则，适用于所有 Spec，不应随意修改。
> 场景特定的规则请参考 `CURRENT_CONTEXT.md`

---

## 📋 Spec 驱动开发

### 命名规范
**格式**: `{序号}-{序号}-{简短描述}` (kebab-case)

**示例**: ✅ `01-00-user-authentication` | ❌ `user-auth` (缺序号) | ❌ `UserAuth` (非kebab-case)

### 工作流程
```
创建 Spec → requirements.md → design.md → tasks.md → 执行任务 → 产物归档
```

### 目录结构
```
.kiro/specs/{feature-name}/
├── requirements.md, design.md, tasks.md
├── scripts/, reports/, diagnostics/, tests/, results/
```

---

## ⚠️ 核心原则

### 1. Spec 驱动开发
- 任何需求必须先建立 Spec
- 所有产物归档到 Spec 目录（scripts/, reports/, diagnostics/, tests/, results/）
- 禁止将脚本、测试直接放到项目根目录

### 2. 文件管理
**根目录**: 禁止随意生成临时文件，用完立即删除

**Steering 目录严格管控** ⚠️:
- 该目录所有文件在每个 session 自动加载
- 只能放置: CORE_PRINCIPLES.md, ENVIRONMENT.md, CURRENT_CONTEXT.md, RULES_GUIDE.md
- 禁止放置: 分析报告、历史数据、临时文件、详细文档
- 其他内容归档到: `.kiro/specs/` 或 `docs/`

### 3. 质量零容忍 ⚠️⚠️⚠️

**千里之堤溃于蚁穴 - 绝不忽视任何问题**

**代码质量**:
- 代码必须编译通过
- 修改后必须运行相关测试
- 遵循项目编码规范

**测试失败零容忍**:
- ❌ 绝对禁止: 忽视测试失败（即使看起来"无关"）
- ❌ 绝对禁止: 测试失败情况下发布版本
- ✅ 必须执行: 调查每个失败的根本原因
- ✅ 必须执行: 修复所有失败后才能继续
- ✅ 必须执行: 发布前运行完整测试套件

**避免重复测试** ⚠️:
- ❌ 禁止: Spec 执行过程中已运行测试，完成后再次运行全量测试
- ✅ 正确: 任务执行中运行测试验证，完成后直接总结，不重复测试
- ✅ 例外: 如果任务执行中未运行测试，完成时必须运行
- **原因**: 避免浪费时间和资源，提高开发效率

**为什么重要**: 测试是质量最后防线 | 小问题累积导致系统崩溃 | 忽视问题让修复成本指数级增长 | 重复测试浪费资源

### 4. Ultrawork 精神 🔥

**核心**: 像西西弗斯推石上山，永不放弃，直到任务完美完成

**执行标准**:
- 专业级质量: 追求生产级标准，不满足于"差不多"
- 不懈努力: 持续尝试解决方案，不轻易放弃或求助用户
- 完整交付: 确保输出完整、准确、可用

**各阶段要求**:
- Requirements: 深入思考场景，考虑边界、异常、安全、性能
- Design: 确保架构优雅、可扩展、易维护，符合最佳实践
- Tasks: 确保代码质量、测试覆盖、文档完整

**困难处理**:
- 编译错误 → 分析根因，持续修复
- 逻辑问题 → 重审需求，不断迭代
- 技术难题 → 换思路，查资料，持续突破
- 卡住不动 → 分解问题，多维尝试
- **永不轻易转移责任给用户**

**质量标准**:
- Requirements: 覆盖所有场景，验收标准清晰可测试
- Design: 架构合理，组件职责清晰，有完整双向追溯
- Tasks: 代码编译通过，测试全部通过，文档完整

### 5. 上下文管控

**主动管控，避免 token 耗尽**

**管控时机**:
- 每完成一组任务 → 精简已完成任务详细内容
- 每完成一个阶段 → 更新 CURRENT_CONTEXT.md
- Token 使用率 > 50% → 立即精简
- 阶段切换 → 更新 CURRENT_CONTEXT.md 聚焦新阶段

**精简规则**:
- Spec 文档: 保留任务标题和状态，删除详细实现
- CURRENT_CONTEXT.md: 只保留当前任务核心信息
- 文档 > 1000 行: 立即拆分为多个文件
- 历史数据: 归档到 Spec 目录

### 6. Steering 更新

**每完成一个 Spec，开始新 Spec 前，评估是否需要更新 Steering**:
- 通用经验教训 → 更新 CORE_PRINCIPLES
- 当前 Spec 场景 → 更新 CURRENT_CONTEXT

### 7. 数据原子性原则

**核心**: 每类数据有且仅有一个权威数据源（Single Source of Truth）

**适用范围**:
- 配置数据: 不应有多个配置文件存储相同信息
- 缓存数据: 派生数据应有唯一缓存源
- 状态数据: 系统状态应集中管理

**设计要求**:
- 避免数据源多重性
- 保证更新原子性
- 从架构层面保证数据一致性

**违反后果**: 数据不一致 | 同步复杂度增加 | 事务性保证困难 | 维护成本上升

**示例**:
```javascript
// ❌ 错误：数据分散
~/.kse/workspaces.json  - 存储工作区列表 + last_accessed
~/.kse/config.json      - 存储 active_workspace

// ✅ 正确：单一数据源
~/.kse/workspace-state.json  - 存储所有工作区相关数据
```

---

**版本**: v8.0  
**更新**: 2026-01-29  
**说明**: 添加"避免重复测试"规则
**变更**: 质量零容忍原则中增加避免重复测试的明确规则
