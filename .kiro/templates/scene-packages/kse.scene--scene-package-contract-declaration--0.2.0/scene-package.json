{
  "apiVersion": "kse.scene.package/v0.1",
  "kind": "scene-domain-profile",
  "metadata": {
    "group": "kse.scene",
    "name": "scene-package-contract-declaration",
    "version": "0.2.0",
    "summary": "Template contract for scene-package-contract-declaration",
    "description": "Domain profile template for scene package metadata governance, ontology mapping, and compatibility decision strategy."
  },
  "compatibility": {
    "kse_version": ">=1.24.0",
    "scene_api_version": "kse.scene/v0.2",
    "moqui_model_version": "3.x",
    "adapter_api_version": "v1"
  },
  "capabilities": {
    "provides": [
      "scene.scene-domain-profile.core"
    ],
    "requires": [
      "binding:http",
      "profile:erp"
    ]
  },
  "parameters": [
    {
      "id": "entity_name",
      "type": "string",
      "required": true,
      "description": "Primary entity name for generated scene flow"
    },
    {
      "id": "service_name",
      "type": "string",
      "required": false,
      "default": "queryService",
      "description": "Optional service binding reference"
    }
  ],
  "artifacts": {
    "entry_scene": "custom/scene.yaml",
    "generates": [
      "custom/scene.yaml"
    ]
  },
  "governance": {
    "risk_level": "low",
    "approval_required": false,
    "approval": {
      "required": false
    },
    "idempotency": {
      "required": true,
      "key": "packageCoordinate"
    },
    "rollback_supported": true
  },
  "capability_contract": {
    "bindings": [
      {
        "type": "query",
        "ref": "spec.erp.scene-package-contract-read",
        "timeout_ms": 1500,
        "retry": 0,
        "intent": "Read package contract metadata and normalize package coordinate input",
        "preconditions": [
          "package coordinate is provided",
          "caller has profile:erp read permission"
        ],
        "postconditions": [
          "metadata fields are loaded",
          "coordinate is normalized"
        ]
      },
      {
        "type": "query",
        "ref": "spec.erp.scene-package-compatibility-check",
        "timeout_ms": 1500,
        "retry": 1,
        "depends_on": "spec.erp.scene-package-contract-read",
        "intent": "Evaluate kse and scene API compatibility against policy baseline",
        "preconditions": [
          "contract metadata is loaded",
          "target runtime policy is available"
        ],
        "postconditions": [
          "compatibility status is produced",
          "incompatible constraints are explained"
        ]
      },
      {
        "type": "query",
        "ref": "spec.erp.scene-package-metadata-query",
        "timeout_ms": 2000,
        "retry": 1,
        "depends_on": "spec.erp.scene-package-compatibility-check",
        "intent": "Build consolidated package metadata view for publishing and routing",
        "preconditions": [
          "compatibility status is available"
        ],
        "postconditions": [
          "metadata view includes governance and compatibility dimensions"
        ]
      }
    ]
  },
  "governance_contract": {
    "risk_level": "low",
    "approval": {
      "required": false
    },
    "idempotency": {
      "required": true,
      "key": "packageCoordinate"
    },
    "data_lineage": {
      "sources": [
        {
          "ref": "spec.erp.scene-package-contract-read",
          "fields": [
            "group",
            "name",
            "version"
          ]
        }
      ],
      "transforms": [
        {
          "operation": "normalizePackageCoordinate",
          "description": "Normalize group/name/version into package coordinate."
        },
        {
          "operation": "evaluateCompatibilityPolicy",
          "description": "Apply compatibility policy rules and annotate risk."
        }
      ],
      "sinks": [
        {
          "ref": "spec.erp.scene-package-metadata-query",
          "fields": [
            "packageCoordinate",
            "compatibilityStatus",
            "riskLevel"
          ]
        }
      ]
    },
    "business_rules": [
      {
        "id": "rule.package-coordinate-unique",
        "description": "Package coordinate must be unique in registry scope.",
        "entity_ref": "package_contract",
        "bind_to": "spec.erp.scene-package-contract-read",
        "status": "enforced"
      },
      {
        "id": "rule.compatibility-before-publish",
        "description": "Compatibility check must pass before metadata publication.",
        "entity_ref": "compatibility_profile",
        "bind_to": "spec.erp.scene-package-compatibility-check",
        "status": "active"
      }
    ],
    "decision_logic": [
      {
        "id": "decision.compatibility-gate-strategy",
        "description": "Block publication when scene_api_version is incompatible.",
        "bind_to": "spec.erp.scene-package-compatibility-check",
        "status": "resolved",
        "automated": true
      },
      {
        "id": "decision.risk-annotation-strategy",
        "description": "Use low/medium/high annotation based on policy violations.",
        "bind_to": "spec.erp.scene-package-metadata-query",
        "status": "resolved",
        "automated": true
      }
    ]
  },
  "ontology_model": {
    "entities": [
      {
        "id": "package_contract",
        "type": "core"
      },
      {
        "id": "compatibility_profile",
        "type": "policy"
      },
      {
        "id": "metadata_view",
        "type": "projection"
      }
    ],
    "relations": [
      {
        "source": "package_contract",
        "target": "compatibility_profile",
        "type": "produces"
      },
      {
        "source": "compatibility_profile",
        "target": "metadata_view",
        "type": "produces"
      }
    ]
  },
  "agent_hints": {
    "summary": "Profile for package metadata governance and compatibility decision flow.",
    "complexity": "medium",
    "estimated_duration_ms": 2500,
    "required_permissions": [
      "registry.read",
      "policy.read"
    ],
    "suggested_sequence": [
      "spec.erp.scene-package-contract-read",
      "spec.erp.scene-package-compatibility-check",
      "spec.erp.scene-package-metadata-query"
    ],
    "rollback_strategy": "Re-run compatibility check and keep previous metadata projection."
  }
}
