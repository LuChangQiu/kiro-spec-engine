{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://scene-capability-engine.dev/contracts/symbol-evidence.schema.json",
  "title": "Symbol Evidence Contract",
  "type": "object",
  "required": [
    "mode",
    "query",
    "hits",
    "evidence",
    "summary"
  ],
  "properties": {
    "mode": {
      "const": "symbol-evidence-locate"
    },
    "query": {
      "type": "string",
      "minLength": 1
    },
    "hits": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "file",
          "line",
          "snippet",
          "symbol",
          "score",
          "source"
        ],
        "properties": {
          "file": {
            "type": "string",
            "minLength": 1
          },
          "line": {
            "type": "integer",
            "minimum": 1
          },
          "snippet": {
            "type": "string"
          },
          "symbol": {
            "type": "string"
          },
          "score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "source": {
            "type": "string",
            "enum": [
              "text-grep",
              "symbol-heuristic"
            ]
          }
        },
        "additionalProperties": false
      }
    },
    "evidence": {
      "type": "object",
      "required": [
        "confidence",
        "reliable",
        "fallback_action",
        "advisory"
      ],
      "properties": {
        "confidence": {
          "type": "string",
          "enum": [
            "high",
            "medium",
            "low",
            "none"
          ]
        },
        "reliable": {
          "type": "boolean"
        },
        "fallback_action": {
          "type": "string",
          "enum": [
            "allow_write",
            "block_high_risk_write"
          ]
        },
        "advisory": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "summary": {
      "type": "object",
      "required": [
        "searched_files",
        "candidate_files",
        "total_hits",
        "reliable_hits"
      ],
      "properties": {
        "searched_files": {
          "type": "integer",
          "minimum": 0
        },
        "candidate_files": {
          "type": "integer",
          "minimum": 0
        },
        "total_hits": {
          "type": "integer",
          "minimum": 0
        },
        "reliable_hits": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
